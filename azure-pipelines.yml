pool:
  vmImage: 'ubuntu-16.04'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.6'

# Would like to use this in the future and proxy through wb-artifacts for everything
# - task: PipAuthenticate@0
#  inputs:
#    artifactFeeds: wb-artifacts

- script: make init

- script: make test

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testResultsFiles: '**/test-*.xml'
    testRunTitle: 'Publish test results for Python $(python.version)'

- task: TwineAuthenticate@0
  inputs:
    artifactFeeds: wb-artifacts

- script: 'pipenv run twine -r wb-artifacts dist/*'